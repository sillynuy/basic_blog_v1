{% extends "blog_base.html" %}

{% block title %}
{{ post.headline }} - Блог Никиты
{% endblock %}

{% block content %}
    <h2>{{ post.headline }}</h2>

    <a href="{% url 'blog:post_edit' post.id %}">Редактировать</a>
    <a href="{% url 'blog:post_delete' post.id %}">Удалить</a>

    <h3>{{ post.date_published|date:"j E Y, G:i" }}</h3>
    <p>{{ post.text|linebreaks }}</p>
    <p>Рейтинг поста: {{ post.rating }} (+{{ post.pos_marks }}-{{ post.neg_marks }})</p>

    <h3>Добавить комментарий</h3>
    {% if user.is_authenticated %}
        <form method="post">
            {% csrf_token %}
            <input type="submit" name="set_mark_post" value="+">
            <input type="submit" name="set_mark_post" value="-">
        </form>
        {% if mark %}
            <p>Ваша оценка: {{ mark }}</p>
        {% endif %}
        <form method="post">
            {% csrf_token %}
            <table>
                {{ comment_form_auth }}
            </table>
            <input type="submit" value="Отправить" name="add_comment_auth">
        </form>
    {% else %}
        <p><a href="{% url 'login' %}">Авторизуйтесь</a>, чтобы иметь возможность оставлять комментарии и оценивать посты.</p>
    {% endif %}
    <h2>Комментарии</h2>
    {% if comments %}
        <h3>Всего комментариев к записи - {{ comments|length }}</h3>
        {% for comment in comments %}
            <h5>{{ comment.date_published }}</h5>
            <h4><a href="{% url 'blog:profile' comment.author_id %}">{{ comment.author }}</a></h4>
            <p>{{ comment.text }}</p>
        {% endfor %}
    {% else %}
        <p>Комментариев пока нет</p>
    {% endif %}
{% endblock %}